<Window x:Class="RandPicker.WPF.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:RandPicker.WPF.ViewModels"
        xmlns:converters="clr-namespace:RandPicker.WPF.Converters"
        mc:Ignorable="d"
        Title="随机选择器" 
        Height="700" 
        Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        d:DataContext="{d:DesignInstance Type=viewmodels:MainViewModel}">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:BooleanToVisibilityInverseConverter x:Key="BooleanToVisibilityInverseConverter" />
    </Window.Resources>
    
    <materialDesign:DialogHost Identifier="RootDialog">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 顶部工具栏 -->
            <materialDesign:ColorZone Mode="PrimaryDark" Padding="16" materialDesign:ElevationAssist.Elevation="Dp4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Dice5Outline" Width="32" Height="32" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="随机选择器" 
                                   Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Command="{Binding OpenSettingsCommand}"
                                ToolTip="设置"
                                Style="{StaticResource MaterialDesignIconButton}">
                            <materialDesign:PackIcon Kind="Settings" Width="24" Height="24"/>
                        </Button>
                        <Button Command="{Binding OpenStudentManagementCommand}"
                                ToolTip="学生管理"
                                Style="{StaticResource MaterialDesignIconButton}">
                            <materialDesign:PackIcon Kind="AccountMultiple" Width="24" Height="24"/>
                        </Button>
                        <Button Command="{Binding OpenGroupManagementCommand}"
                                ToolTip="分组管理"
                                Style="{StaticResource MaterialDesignIconButton}">
                            <materialDesign:PackIcon Kind="AccountGroup" Width="24" Height="24"/>
                        </Button>
                        <Button Command="{Binding OpenHistoryCommand}"
                                ToolTip="历史记录"
                                Style="{StaticResource MaterialDesignIconButton}">
                            <materialDesign:PackIcon Kind="History" Width="24" Height="24"/>
                        </Button>
                        <Button Command="{Binding ToggleFloatingWindowCommand}"
                                ToolTip="浮动窗口"
                                Style="{StaticResource MaterialDesignIconButton}">
                            <materialDesign:PackIcon Kind="WindowMaximize" Width="24" Height="24"/>
                        </Button>
                        <materialDesign:PopupBox Style="{StaticResource MaterialDesignPopupBox}" PlacementMode="BottomAndAlignRightEdges">
                            <StackPanel>
                                <TextBlock Text="导出" Margin="16,8" Style="{StaticResource MaterialDesignSubtitle1TextBlock}"/>
                                <Separator/>
                                <Button Content="导出学生数据 (Excel)" Command="{Binding ExportDataCommand}" CommandParameter="students_excel"/>
                                <Button Content="导出学生数据 (CSV)" Command="{Binding ExportDataCommand}" CommandParameter="students_csv"/>
                                <Button Content="导出学生数据 (PDF)" Command="{Binding ExportDataCommand}" CommandParameter="students_pdf"/>
                                <Button Content="导出学生数据 (JSON)" Command="{Binding ExportDataCommand}" CommandParameter="students_json"/>
                                <Separator/>
                                <Button Content="导出分组数据 (Excel)" Command="{Binding ExportDataCommand}" CommandParameter="groups_excel"/>
                                <Button Content="导出分组数据 (CSV)" Command="{Binding ExportDataCommand}" CommandParameter="groups_csv"/>
                                <Button Content="导出分组数据 (PDF)" Command="{Binding ExportDataCommand}" CommandParameter="groups_pdf"/>
                                <Button Content="导出分组数据 (JSON)" Command="{Binding ExportDataCommand}" CommandParameter="groups_json"/>
                                <Separator/>
                                <Button Content="导出历史记录 (Excel)" Command="{Binding ExportDataCommand}" CommandParameter="history_excel"/>
                                <Button Content="导出历史记录 (CSV)" Command="{Binding ExportDataCommand}" CommandParameter="history_csv"/>
                                <Button Content="导出历史记录 (PDF)" Command="{Binding ExportDataCommand}" CommandParameter="history_pdf"/>
                                <Button Content="导出历史记录 (JSON)" Command="{Binding ExportDataCommand}" CommandParameter="history_json"/>
                            </StackPanel>
                        </materialDesign:PopupBox>
                    </StackPanel>
                </Grid>
            </materialDesign:ColorZone>

            <!-- 主内容区域 -->
            <Grid Grid.Row="1" Margin="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 左侧面板 -->
                <materialDesign:Card Margin="0,0,8,0">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="学生列表" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="1" 
                                   Text="{Binding Students.Count, StringFormat=共 {0} 名学生}"
                                   Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                   Margin="0,0,0,8"/>

                        <ListBox Grid.Row="2" 
                                 ItemsSource="{Binding Students}"
                                 SelectedItem="{Binding SelectedStudent}"
                                 Style="{StaticResource MaterialDesignListBox}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <CheckBox IsChecked="{Binding Active}" 
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,8,0"/>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" 
                                                       Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                            <TextBlock Text="{Binding Id, StringFormat=学号: {0}}" 
                                                       Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                            <TextBlock Text="{Binding Weight, StringFormat=权重: {0}}" 
                                                       Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </materialDesign:Card>

                <!-- 中间操作区 -->
                <materialDesign:Card Grid.Column="1" 
                                     Width="300"
                                     Margin="8,0"
                                     VerticalAlignment="Center">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="选择模式" 
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,8"/>

                        <ComboBox Grid.Row="1"
                                  SelectedValue="{Binding SelectedMode}"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                  HorizontalAlignment="Stretch"
                                  Margin="0,0,0,16">
                            <ComboBoxItem Content="Individual">
                                <ComboBoxItem.ContentTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Account" Margin="0,0,8,0"/>
                                            <TextBlock Text="个人选择"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBoxItem.ContentTemplate>
                            </ComboBoxItem>
                            <ComboBoxItem Content="Group">
                                <ComboBoxItem.ContentTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="AccountGroup" Margin="0,0,8,0"/>
                                            <TextBlock Text="分组选择"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBoxItem.ContentTemplate>
                            </ComboBoxItem>
                        </ComboBox>

                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,16">
                            <CheckBox Content="使用权重" 
                                      IsChecked="{Binding UseWeight}"
                                      Style="{StaticResource MaterialDesignCheckBox}"
                                      Margin="0,0,16,0"/>
                            <CheckBox Content="显示动画" 
                                      IsChecked="{Binding ShowAnimation}"
                                      Style="{StaticResource MaterialDesignCheckBox}"/>
                        </StackPanel>

                        <Button Grid.Row="3"
                                Command="{Binding PickRandomCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Width="120"
                                Height="120"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,16"
                                IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}">
                            <materialDesign:PackIcon Kind="Dice5" Width="64" Height="64"/>
                        </Button>

                        <TextBlock Grid.Row="4"
                                   Text="{Binding SelectedResult}"
                                   Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,8"/>

                        <ProgressBar Grid.Row="5"
                                     IsIndeterminate="{Binding IsBusy}"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                                     Style="{StaticResource MaterialDesignLinearProgressBar}"
                                     Height="4"/>
                    </Grid>
                </materialDesign:Card>

                <!-- 右侧面板 -->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 分组列表 -->
                    <materialDesign:Card Margin="8,0,0,8">
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="分组列表" 
                                       Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                       Margin="0,0,0,8"/>

                            <TextBlock Grid.Row="1" 
                                       Text="{Binding Groups.Count, StringFormat=共 {0} 个分组}"
                                       Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                       Margin="0,0,0,8"/>

                            <ListBox Grid.Row="2" 
                                     ItemsSource="{Binding Groups}"
                                     SelectedItem="{Binding SelectedGroup}"
                                     Style="{StaticResource MaterialDesignListBox}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" 
                                                       Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                            <TextBlock Text="{Binding StudentCount, StringFormat=成员数: {0}}" 
                                                       Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </materialDesign:Card>

                    <!-- 分隔线 -->
                    <Separator Grid.Row="1" Margin="8,0"/>

                    <!-- 历史记录 -->
                    <materialDesign:Card Grid.Row="2" Margin="8,8,0,0">
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="最近历史记录" 
                                       Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                       Margin="0,0,0,8"/>

                            <ListBox Grid.Row="1" 
                                     ItemsSource="{Binding HistoryItems}"
                                     Style="{StaticResource MaterialDesignListBox}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding SelectedName}" 
                                                       Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding ModeDisplayName}" 
                                                           Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                                           Margin="0,0,8,0"/>
                                                <TextBlock Text="{Binding FormattedTime}" 
                                                           Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </materialDesign:Card>
                </Grid>
            </Grid>

            <!-- 底部状态栏 -->
            <materialDesign:ColorZone Grid.Row="2" Mode="PrimaryLight" Padding="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="随机选择器 WPF 版本" VerticalAlignment="Center"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <TextBlock Text="主题: " VerticalAlignment="Center"/>
                        <ComboBox Width="80" SelectedValue="{Binding AppSettings.Theme}">
                            <ComboBoxItem Content="Light"/>
                            <ComboBoxItem Content="Dark"/>
                            <ComboBoxItem Content="Auto"/>
                        </ComboBox>
                    </StackPanel>
                </Grid>
            </materialDesign:ColorZone>

            <!-- 浮动窗口 -->
            <Popup IsOpen="{Binding ShowFloatingWindow}" 
                   StaysOpen="True" 
                   AllowsTransparency="True"
                   Placement="Custom"
                   PlacementRectangle="0,0,0,0"
                   HorizontalOffset="100"
                   VerticalOffset="100">
                <materialDesign:Card Background="{DynamicResource MaterialDesignPaper}" 
                                     UniformCornerRadius="8"
                                     Padding="16"
                                     Width="300"
                                     materialDesign:ElevationAssist.Elevation="Dp8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="浮动窗口" 
                                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                   Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="1"
                                   Text="{Binding SelectedResult}"
                                   Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextWrapping="Wrap"
                                   Margin="0,16,0,16"/>

                        <Button Grid.Row="2"
                                Command="{Binding PickRandomCommand}"
                                Content="随机选择"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                HorizontalAlignment="Center"/>
                    </Grid>
                </materialDesign:Card>
            </Popup>

            <!-- 加载遮罩 -->
            <Grid Grid.RowSpan="3" 
                  Background="#80000000" 
                  Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" 
                                 Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 Value="0"
                                 Width="48"
                                 Height="48"
                                 Margin="0,0,0,16"/>
                    <TextBlock Text="加载中..." 
                               Foreground="White"
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>
